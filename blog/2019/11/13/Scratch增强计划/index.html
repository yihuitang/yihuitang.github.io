<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.58">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/video.js/dist/video-js.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@videojs/themes@1/dist/fantasy/index.css">
<script src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lettering.js/0.6.1/jquery.lettering.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/video.js/dist/video.min.js"></script>
<script src="/script/settheme.js"></script><title data-react-helmet="true">Scratch增强计划 | CodeLab</title><meta data-react-helmet="true" property="og:title" content="Scratch增强计划 | CodeLab"><meta data-react-helmet="true" name="description" content="There are many ways to live your life. That&#x27;s may be the most important thing you can realize in your life is that every aspect of your life is a choice..."><meta data-react-helmet="true" property="og:description" content="There are many ways to live your life. That&#x27;s may be the most important thing you can realize in your life is that every aspect of your life is a choice..."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.png"><link rel="stylesheet" href="/styles.84b1147b.css">
<link rel="preload" href="/styles.71fb8b2a.js" as="script">
<link rel="preload" href="/runtime~main.676e3002.js" as="script">
<link rel="preload" href="/main.aad9f3c1.js" as="script">
<link rel="preload" href="/1.af123087.js" as="script">
<link rel="preload" href="/2.2944d33e.js" as="script">
<link rel="preload" href="/3.ffbe02f2.js" as="script">
<link rel="preload" href="/ccc49370.9d6295d9.js" as="script">
<link rel="preload" href="/fb7d632c.f0cbfb9e.js" as="script">
</head>
<body>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="My Site Logo"></a><a href="https://create.codelab.club" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">创作平台</a><a class="navbar__item navbar__link" href="/projects">玩给你看</a><a href="https://create.codelab.club/ideas#course" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">课程</a><a href="https://adapter.codelab.club/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">文档</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">博客</a><a class="navbar__item navbar__link" href="/blog/2020/09/25/about-codelab-2020">关于我们</a><a href="https://github.com/CodeLabClub" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link"></a></div><div class="navbar__items navbar__items--right"></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.png" alt="My Site Logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a href="https://create.codelab.club" target="_blank" rel="noopener noreferrer" class="menu__link">创作平台</a></li><li class="menu__list-item"><a class="menu__link" href="/projects">玩给你看</a></li><li class="menu__list-item"><a href="https://create.codelab.club/ideas#course" target="_blank" rel="noopener noreferrer" class="menu__link">课程</a></li><li class="menu__list-item"><a href="https://adapter.codelab.club/" target="_blank" rel="noopener noreferrer" class="menu__link">文档</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/blog">博客</a></li><li class="menu__list-item"><a class="menu__link" href="/blog/2020/09/25/about-codelab-2020">关于我们</a></li><li class="menu__list-item"><a href="https://github.com/CodeLabClub" target="_blank" rel="noopener noreferrer" class="menu__link header-github-link"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--8 col--offset-2"><article><header><h1 class="margin-bottom--sm blogPostTitle_kDB-">Scratch增强计划</h1><div class="margin-vert--md"><time datetime="2019-11-13T00:00:00.000Z" class="blogPostDate_2HVl">2019年11月13日   · 2 min 阅读时长</time></div><div class="avatar margin-vert--md"><div class="avatar__intro"><h4 class="avatar__name"><a target="_blank" rel="noreferrer noopener">种瓜</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><img class="img-responsive" src="/img/create_2767ae26.png"><blockquote><p> There are many ways to live your life. That&#x27;s may be the most important thing you can realize in your life is that every aspect of your life is a choice...<br>
You can choose to accept the world as it is but you don&#x27;t have to.<br>
If there is something in the world you feel the wrong and you have a vision for what a better world could be, you can find your guiding principle and you can fight for a cause.<br>
So after the talk I&#x27;d like you to take a little time and think about what matters to you？what you believe in？ what you might fight for？ -- Bret Victor《Inventing on Principle》</p></blockquote><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="前言"></a>前言<a aria-hidden="true" tabindex="-1" class="hash-link" href="#前言" title="Direct link to heading">#</a></h1><p>上周六，我一直在看<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>的博客，他的工作给我极大的震撼，几乎是叹为观止。</p><p>看了他的演讲和文章，夜里和朋友聊了很久，他让我们觉得自己生活在原始时代，刀耕火种，难以忍受。周日下午走街串巷，漫无目的的徒步，一直在想<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>说的一些东西，下午的阳光很好，走在广州的老街道，树木盈抱，墙面斑驳，傍晚时候，一切看起来都像90年代，从<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>的演讲回到现实，好像穿越到了过去，周围的一切都显得那么原始。</p><p>关于什么是好的编程环境，什么是好的创造工具，我从前对此一无所知，觉得目前手头的工具基本够用。<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>使我相信，我完全不懂编程是什么。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="smalltalk"></a>Smalltalk<a aria-hidden="true" tabindex="-1" class="hash-link" href="#smalltalk" title="Direct link to heading">#</a></h1><p>一直没有痛下决心将<a href="https://zh.wikipedia.org/zh-hans/Smalltalk" target="_blank" rel="noopener noreferrer">Smalltalk</a>作为我的主要语言。此前玩了段时间<a href="https://zh.wikipedia.org/zh-hans/Squeak" target="_blank" rel="noopener noreferrer">squeak</a>(Smalltalk的一个方言)，在上边很轻松写出了scratch的原型，<a href="https://github.com/LLK/Scratch_1.4">scratch的第一代</a>就是用<a href="https://zh.wikipedia.org/zh-hans/Squeak" target="_blank" rel="noopener noreferrer">squeak</a>写的，scratch与创造有关的核心设计似乎都来自<a href="https://zh.wikipedia.org/zh-hans/Squeak" target="_blank" rel="noopener noreferrer">squeak</a>。正如scratch之父所言scratch的主要创造是社区。这是很中肯的描述。</p><p>之后又玩了段时间<a href="https://en.wikipedia.org/wiki/Etoys_(programming_language)" target="_blank" rel="noopener noreferrer">Etoys</a>。</p><p>最近有一搭没一搭地使用<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a> ，<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a>是现代Smalltalk方言。</p><p><a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>给了我最后一根稻草，让我确信切换到<a href="https://zh.wikipedia.org/zh-hans/Smalltalk" target="_blank" rel="noopener noreferrer">Smalltalk</a>是极为重要的一件事，它是绝佳的创造工具。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="new-scratch30-virtual-machine"></a>New Scratch3.0 Virtual Machine<a aria-hidden="true" tabindex="-1" class="hash-link" href="#new-scratch30-virtual-machine" title="Direct link to heading">#</a></h1><p>我准备在<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a>中实现Scratch3.0 Virtual Machine，把scratch重新带回Smalltalk。它既作为我驱动自己学习<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a>的项目，又作为探索scratch未来可能性的尝试。尽管最终可能实现出JavaScript版本(考虑到对用户友好)，但正如<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>所言，JavaScript和processing都不是好的语言，它并不适合用于探索。今天有许多公司，用JavaScript(Blockly)去重新抄一遍scratch，除了换一个UI，源代码更为草率，扩展性更糟之外，在编程和创造性这件事上，几乎没有任何改进（事实上基本都是倒退）。有那么多有意思的事情值得做，换一个皮肤的事，竟吸引了那么多公司动则千万的投入。</p><p>一旦在<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a>中实现了Scratch的解释器，我们就可以轻松使用<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>的创造原则去增强它。</p><p>我希望让新的vm(Virtual Machine)能够解释运行sb3文件。sb3文件结构的设计是很优秀的,我在<a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html">Scratch3技术分析之项目内部数据(第6篇）</a>做了阐述。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="副产品"></a>副产品<a aria-hidden="true" tabindex="-1" class="hash-link" href="#副产品" title="Direct link to heading">#</a></h1><p>在实现这个目标的途中可能会顺便得到一些有趣的副产品，有些可能是目前Scratch3.0的用户和开发者所关心的，我大致列一些，目前能想到的一些有趣副产品包括:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="1将scratch项目导出为本地应用"></a>1.将scratch项目导出为本地应用<a aria-hidden="true" tabindex="-1" class="hash-link" href="#1将scratch项目导出为本地应用" title="Direct link to heading">#</a></h3><p>scratch社区的用户似乎一直有一个需求: 将scratch项目导出为本地应用(exe/app). 要做到这点，按目前scratch3.0的架构也能做到，诸如直接导出一个electron应用，不过这实在有点笨重。</p><p>新的解释器接受sb3文件作为输入，然后解释运行它，所以我们可以做得非常精简。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="2离线运行scratch30项目"></a>2.离线运行scratch3.0项目<a aria-hidden="true" tabindex="-1" class="hash-link" href="#2离线运行scratch30项目" title="Direct link to heading">#</a></h3><p>Scratch3.0目前运行在浏览器中，总是需要GUI支持，如果导出的程序并不是视觉动画，例如程序用来将家庭自动化(我在<a href="https://codelab-adapter-docs.codelab.club/user_guide/gallery/" target="_blank" rel="noopener noreferrer">这里展示了很多例子</a>)，我们能否让它离线运行，不用总开着浏览器，让它跑在云端，或跑在没有屏幕的树莓派上。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="3评估用户的计算思维computational-thinking"></a>3.评估用户的计算思维(computational thinking)<a aria-hidden="true" tabindex="-1" class="hash-link" href="#3评估用户的计算思维computational-thinking" title="Direct link to heading">#</a></h3><p>做新的解释器过程中，我们需要深入到scratch程序的所有细节里，这就逼着我们做出类似静态分析器的东西，我们自然会理解用户用到的所有程序元素，我们可以据此评估他在程序中展现的计算思维(computational thinking)。评估的教育框架会采用Scratch之父(Mitchel Resnick)早年的论文。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="4一些通用的sb3文件处理工具"></a>4.一些通用的sb3文件处理工具<a aria-hidden="true" tabindex="-1" class="hash-link" href="#4一些通用的sb3文件处理工具" title="Direct link to heading">#</a></h3><p>由于需要解析sb3文件，所以会顺手打造一些通用的小工具。</p><p>今天就简单写了一个脚本, 允许用户解压sb3文件，本地编辑之后，再重新生成sb3，之后在scratch3.0编辑器中依然能加载它. 这有什么用呢？还挺有用的，比如说我目前的一个用例: 之前保存的一些sb3项目在新的scratch3.0编辑器中打不开了(可能是新的平台不存在旧的extension)，我通过移除sb3中对应的extension block就可以重新加载项目。</p><p>脚本源码和使用方法在这里:<a href="https://gist.github.com/wwj718/cd2447e68409a0f36141f4d1d7698fd9" target="_blank" rel="noopener noreferrer">sb3_compress.py</a></p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="关于codelab-adapter"></a>关于<a href="https://codelab-adapter-docs.codelab.club/" target="_blank" rel="noopener noreferrer">codelab-adapter</a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#关于codelab-adapter" title="Direct link to heading">#</a></h1><p>新的虚拟机依然能够与<a href="https://codelab-adapter-docs.codelab.club/" target="_blank" rel="noopener noreferrer">codelab-adapter</a>通信，我目前计划采用ZeroMQ来实现。事实上<a href="https://codelab-adapter-docs.codelab.club/" target="_blank" rel="noopener noreferrer">codelab-adapter</a>会采用越来越多<a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a>建议的设计原则。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="进展与笔记"></a>进展与笔记<a aria-hidden="true" tabindex="-1" class="hash-link" href="#进展与笔记" title="Direct link to heading">#</a></h1><p>近期，我刚开始着手做这件事，<a href="https://blog.just4fun.site/Scratch3_project_json_analysis_6.html">对项目数据的分析</a>已经完成了。将项目保存为本地文件(sb3)由<a href="https://github.com/LLK/scratch-vm/blob/98b92be2d74ba868d876feaf00a02ceb11dbf311/src/virtual-machine.js#L356">以下代码</a>驱动:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-js codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#ffffff;background-color:#000"><div class="token-line" style="color:#ffffff"><span class="token plain">   </span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> /**</span></div><div class="token-line" style="color:#ffffff"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">     * </span><span class="token doc-comment comment keyword" style="color:rgb(105, 112, 152);font-style:italic">@returns</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> </span><span class="token doc-comment comment class-name punctuation" style="color:rgb(199, 146, 234);font-style:italic">{</span><span class="token doc-comment comment class-name" style="color:rgb(255, 203, 107);font-style:italic">string</span><span class="token doc-comment comment class-name punctuation" style="color:rgb(199, 146, 234);font-style:italic">}</span><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic"> Project in a Scratch 3.0 JSON representation.</span></div><div class="token-line" style="color:#ffffff"><span class="token doc-comment comment" style="color:rgb(105, 112, 152);font-style:italic">     */</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">saveProjectSb3</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> soundDescs </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">serializeSounds</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">runtime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> costumeDescs </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">serializeCostumes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">runtime</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> projectJson </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">toJSON</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// TODO want to eventually move zip creation out of here, and perhaps</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// into scratch-storage</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> zip </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">JSZip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Put everything in a zip file</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;project.json&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> projectJson</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">_addFileDescsToZip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">soundDescs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">concat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">costumeDescs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">generateAsync</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;blob&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            compression</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DEFLATE&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            compressionOptions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">                level</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Tradeoff between best speed (1) and best compression (9)</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">_addFileDescsToZip</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">fileDescs</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">let</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> fileDescs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> currFileDesc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fileDescs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">            zip</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">currFileDesc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">fileName</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> currFileDesc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">fileContent</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>由此可以看出项目的数据是扁平的。这个分析帮助我们构建了小工具:<a href="https://gist.github.com/wwj718/cd2447e68409a0f36141f4d1d7698fd9" target="_blank" rel="noopener noreferrer">sb3_compress.py</a>。</p><p>春节假期将近，在假期里与家人朋友小聚之余，如果能抽出时间，我就到阳台晒晒太阳，熟悉熟悉<a href="https://pharo.org/" target="_blank" rel="noopener noreferrer">Pharo</a>，并顺手构建早期的原型。</p><h1><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="参考"></a>参考<a aria-hidden="true" tabindex="-1" class="hash-link" href="#参考" title="Direct link to heading">#</a></h1><ul><li><a href="http://worrydream.com/" target="_blank" rel="noopener noreferrer">Bret Victor</a></li></ul></section><footer class="row margin-vert--lg"><div class="col"><strong>标签：</strong><a class="margin-horiz--sm" href="/blog/tags/技术文档">技术文档</a><a class="margin-horiz--sm" href="/blog/tags/编程学习">编程学习</a><a class="margin-horiz--sm" href="/blog/tags/adapter">Adapter</a><a class="margin-horiz--sm" href="/blog/tags/python">Python</a></div></footer></article><div><a href="https://github.com/CodeLabClub/NewCodeLabWeb/tree/master/blog/Scratch增强计划.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2019/11/13/Scratch-sb3-parser"><div class="pagination-nav__sublabel">上一篇</div><div class="pagination-nav__label">« Scratch项目解析器</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2019/11/06/rrf-kit"><div class="pagination-nav__sublabel">下一篇</div><div class="pagination-nav__label">Revolution Robotics Challenge Kit: 为STEM教育注入变革的力量 »</div></a></div></nav></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="http://discuss.codelab.club/" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="http://discuss.codelab.club/">CodeLab 论坛</a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2021/07/21/CodeLab-handbook">手册</a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2020/08/20/tools">下载</a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/2020/04/01/欢迎关注CodeLab微信公众号">微信公众号</a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.zhihu.com/people/codelab-83" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://www.zhihu.com/people/codelab-83">在知乎</a></li></ul></div><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://space.bilibili.com/607249092" target="_blank" rel="noopener noreferrer" class="footer__link-item" to="https://space.bilibili.com/607249092">在B站</a></li></ul></div></div><div class="text--center"><div>Copyright © 2022 CodeLab&nbsp&nbsp&nbsp<a style="color:white" target="_blank" href="https://beian.miit.gov.cn/">粤ICP备2021005905号-1</a><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?3be250eb38d350c4a750c4b0bbfe513e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script></div></div></div></footer></div>
<script src="/styles.71fb8b2a.js"></script>
<script src="/runtime~main.676e3002.js"></script>
<script src="/main.aad9f3c1.js"></script>
<script src="/1.af123087.js"></script>
<script src="/2.2944d33e.js"></script>
<script src="/3.ffbe02f2.js"></script>
<script src="/ccc49370.9d6295d9.js"></script>
<script src="/fb7d632c.f0cbfb9e.js"></script>
</body>
</html>